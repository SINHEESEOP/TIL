# 🔄 Stateful, Stateless 그리고 비연결성

## 🧩 상태(State)란 무엇인가?

상태란 클라이언트와 서버 간의 통신에서 이전 요청이나 응답에 대한 정보(컨텍스트)를 의미합니다. 이메일, 장바구니, 로그인 세션 등 사용자별로 유지되는 정보가 상태의 예입니다. 🛒

## 📌 Stateful(상태 유지)

### Stateful이란?
Stateful 방식은 서버가 클라이언트의 상태를 기억하는 방식입니다. 클라이언트가 요청을 보낼 때마다 이전 요청의 맥락을 고려하여 응답합니다. 📝

### 예시: 은행 창구 상담
```
고객: 안녕하세요, 계좌를 개설하고 싶습니다.
은행원: 네, 어떤 종류의 계좌를 원하시나요?
고객: 보통예금 계좌요.
은행원: 입금 금액은 얼마로 하시겠어요?
고객: 10만원이요.
은행원: 계좌가 개설되었습니다. 10만원이 입금되었습니다.
```

위 예시에서 은행원(서버)은 고객(클라이언트)과의 대화 맥락을 모두 기억하고 있습니다.

### 특징
- 서버가 클라이언트의 상태를 저장하고 추적
- 이전 요청의 맥락을 기반으로 응답
- 클라이언트와 서버 간 긴밀한 연결 필요
- 대부분의 전통적인 데스크톱 애플리케이션이 이 방식

### 장점
- 상태 추적이 용이
- 연속적인 작업에 효율적
- 복잡한 프로세스 관리에 적합

### 단점
- 서버 부하 증가 (상태 정보 저장)
- 확장성(Scale out) 제한
- 서버 장애 시 상태 정보 손실 가능성

## 🚫 Stateless(무상태)

### Stateless란?
Stateless 방식은 서버가 클라이언트의 상태를 기억하지 않는 방식입니다. 모든 요청은 독립적이며, 이전 요청과 무관하게 처리됩니다. HTTP는 기본적으로 Stateless 프로토콜입니다. 🔄

### 예시: 티켓 자동 발매기
```
고객(1번째 요청): 서울에서 부산까지 티켓 1장 주세요.
발매기(응답): 서울-부산 티켓 1장 발급했습니다. 5만원입니다.

고객(2번째 요청): 내일 출발하는 걸로 주세요.
발매기(응답): 출발 날짜를 지정하려면 목적지와 인원수도 함께 알려주세요.
```

위 예시에서 발매기(서버)는 이전 요청을 기억하지 않기 때문에 두 번째 요청에서 필요한 모든 정보를 다시 제공해야 합니다.

### 특징
- 서버가 클라이언트의 상태를 저장하지 않음
- 각 요청은 독립적이고 이전 요청의 영향을 받지 않음
- 요청에 필요한 모든 정보가 포함되어야 함
- 웹의 기본 아키텍처 방식

### 장점
- 서버 확장성 높음 (Scale out 용이)
- 서버 단순화 (상태 관리 불필요)
- 서버 장애 시 다른 서버로 쉽게 전환 가능

### 단점
- 매 요청마다 필요한 모든 데이터 전송 (bandwidth 사용량 증가)
- 세션 관리 복잡성 증가
- 사용자 경험 측면에서 추가 작업 필요

## 🌐 HTTP의 Stateless 성질과 실제 활용

HTTP는 기본적으로 Stateless 프로토콜이지만, 실제 웹 애플리케이션에서는 상태 유지가 필요한 경우가 많습니다. 이를 위해 다양한 방법을 사용합니다:

### 상태 유지 메커니즘
1. **쿠키(Cookies)**: 클라이언트 측에 데이터 저장
   ```
   Set-Cookie: user_id=123; expires=Wed, 31 Dec 2023 23:59:59 GMT
   ```

2. **세션(Sessions)**: 서버 측에 데이터 저장, 세션 ID는 쿠키로 전달
   ```
   Set-Cookie: JSESSIONID=ABC123; Path=/; HttpOnly
   ```

3. **토큰(Tokens)**: JWT(JSON Web Tokens) 등을 사용하여 인증 정보 전달
   ```
   Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
   ```

4. **URL 파라미터(Query Parameters)**: URL에 상태 정보 포함
   ```
   https://example.com/products?user_id=123&session=ABC123
   ```

### Stateless 설계의 장점
- **확장성**: 서버를 쉽게 확장할 수 있음 (수평 확장)
- **신뢰성**: 한 서버에 문제가 생겨도 다른 서버로 요청을 전환 가능
- **단순성**: 서버 로직이 단순해짐

## 🔌 비연결성(Connectionless)

### 비연결성이란?
HTTP는 기본적으로 비연결성 프로토콜로, 클라이언트가 요청을 보내고 서버가 응답을 보낸 후 연결을 끊는 방식입니다. 매 요청마다 새로운 연결을 맺고 응답 후 연결을 종료합니다. 🔌

### 특징
- 요청-응답 후 연결 종료
- 서버는 연결 상태를 유지하지 않음
- 필요할 때만 연결하여 서버 자원 효율적 사용

### 장점
- 서버 리소스 낭비 감소
- 불특정 다수를 대상으로 하는 서비스에 적합
- 서버 확장성 증가

### 단점
- 매 요청마다 연결 수립(TCP/IP handshake) 비용 발생
- 웹 페이지 로드 시 여러 자원(이미지, CSS, JS 등)에 대해 각각 연결 필요
- 실시간 통신이 어려움

### 비연결성 문제 해결 방법
1. **HTTP Persistent Connections(Keep-Alive)**: 
   - 연결을 일정 시간 유지하여 재사용
   ```
   Connection: keep-alive
   Keep-Alive: timeout=5, max=1000
   ```

2. **HTTP/2 Multiplexing**: 
   - 하나의 연결로 여러 요청/응답 처리
   - 스트림을 통한 병렬 처리

3. **WebSocket**: 
   - 양방향 실시간 통신을 위한 연결 유지
   - 채팅, 실시간 게임 등에 활용

## 🔄 Stateful vs Stateless 선택 기준

### Stateful이 적합한 경우
- 복잡한 트랜잭션 처리
- 실시간 통신(채팅, 게임)
- 사용자별 맞춤형 서비스

### Stateless가 적합한 경우
- 대규모 분산 시스템
- 높은 확장성이 필요한 서비스
- 단순한 CRUD 작업

## 🧪 실무 예시

### Stateful 시스템 예시
- 온라인 뱅킹 거래 시스템
- 실시간 화상 회의
- 게임 서버

### Stateless 시스템 예시
- RESTful API 서비스
- 마이크로서비스 아키텍처
- CDN(Content Delivery Network)

## 📝 정리

Stateful과 Stateless는 각각 장단점이 있으며, 애플리케이션의 요구사항에 따라 적절한 방식을 선택해야 합니다. 현대 웹 애플리케이션은 대부분 HTTP의 Stateless 특성을 기반으로 하면서도, 필요에 따라 쿠키, 세션, 토큰 등을 활용하여 상태 관리를 구현합니다. 또한 비연결성의 단점을 극복하기 위해 Keep-Alive, HTTP/2, WebSocket 등의 기술을 적용합니다. 🌟 